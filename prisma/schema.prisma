generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  MODERATOR
  COMPANY_ADMIN
  COMPANY_USER
}

enum CommonStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

model User {
  id       String @id @default(uuid())
  username String @unique
  email    String @unique
  password String

  phone   String? // optional
  name    String? // optional
  address String? // optional

  userRole UserRole     @default(COMPANY_USER)
  status   CommonStatus @default(ACTIVE)

  companyId String? // optional, references Company.id
  company   Company? @relation(fields: [companyId], references: [id])

  auditLogs AuditLog[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Company {
  id    String @id @default(uuid())
  name  String
  email String @unique

  description String? // optional
  address     String? // optional
  phone       String? // optional
  currency    String  @default("BDT")

  status CommonStatus @default(ACTIVE)

  users             User[]
  accounts          Account[]
  journalEntries    JournalEntry[]
  auditLogs         AuditLog[]
  accountCategories AccountCategory[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model AccountCategory {
  id   String @id @default(uuid())
  name String

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  accounts Account[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name, companyId])
}

model Account {
  id   String @id @default(uuid())
  name String

  accountType AccountType
  status      CommonStatus @default(ACTIVE)

  companyId  String
  company    Company          @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  categoryId String? // optional
  category   AccountCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  journalLines JournalLine[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JournalEntry {
  id   String   @id @default(uuid())
  date DateTime

  description String? // optional

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  journalLines JournalLine[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model JournalLine {
  id           String  @id @default(uuid())
  debitAmount  Float? // optional, one of debitAmount or creditAmount must be set
  creditAmount Float? // optional, one of debitAmount or creditAmount must be set
  description  String? // optional

  journalEntryId String
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  accountId String
  account   Account @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String
  entity    String
  entityId  String
  timestamp DateTime @default(now())

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}
